(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{312:function(_,v,t){"use strict";t.r(v);var r=t(10),e=Object(r.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"设计思路"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#设计思路"}},[_._v("#")]),_._v(" 设计思路")]),_._v(" "),v("h2",{attrs:{id:"背景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[_._v("#")]),_._v(" 背景")]),_._v(" "),v("p",[_._v("作者"),v("a",{attrs:{href:"https://github.com/orca-zhang",target:"_blank",rel:"noopener noreferrer"}},[_._v("Orca"),v("OutboundLink")],1),_._v("，从2011年开始接触存储，部分工作经历与存储有关。从最早的单机对象存储到后来的分布式对象存储。有的是基于存储的应用（备份一体机、企业云盘、IM后端存储、feed流收发件箱等），也有单纯的公、私有云存储服务。有的是从0到1设计实现，有的是从1到100优化迭代。技术栈从基于文件系统的自研对象文件系统，到基于"),v("code",[_._v("MySQL")]),_._v("+"),v("code",[_._v("OpenStack Swift")]),_._v("（后文简称"),v("code",[_._v("Swift")]),_._v("）、到"),v("code",[_._v("MongoDB")]),_._v("+自研存储，到"),v("code",[_._v("PhxPaxos")]),_._v("+"),v("code",[_._v("LevelDB")]),_._v("的各种实现方案。老司机如果看到有说得不对的地方，还请不吝指教、私我修改，欢迎新同学随时私我交流、一起共建"),v("code",[_._v("OrcaS")]),_._v("。🎉🎉🎉")]),_._v(" "),v("h2",{attrs:{id:"需求"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[_._v("#")]),_._v(" 需求")]),_._v(" "),v("p",[_._v("我目前期望实现一个低成本的单机NAS用于存储私有数据，从几K的小文件到几G的大文件，能够提供一定的扩展性，在此基础上扩展成分布式版本，它应该能够运行在配置较低（CPU、内存、网络）的设备上，比如树莓派或者ARM上，存储可能也是廉价的低擦写次数的，比如TLC闪存的SD存储卡。")]),_._v(" "),v("h3",{attrs:{id:"我希望它该有的样子"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#我希望它该有的样子"}},[_._v("#")]),_._v(" 我希望它该有的样子")]),_._v(" "),v("ul",[v("li",[_._v("尽可能快")]),_._v(" "),v("li",[_._v("支持按需扩容")]),_._v(" "),v("li",[_._v("支持大、小文件")]),_._v(" "),v("li",[_._v("支持按需加密和压缩")]),_._v(" "),v("li",[v("strong",[_._v("传输层透明（端到端）")])]),_._v(" "),v("li",[_._v("能够保障数据可用性")]),_._v(" "),v("li",[_._v("支持随机读部分数据")]),_._v(" "),v("li",[_._v("支持存储对象的多个版本")])]),_._v(" "),v("p",[_._v("如果有这些功能，那就更好了：")]),_._v(" "),v("ul",[v("li",[_._v("秒传：服务端已经存在的文件，不再需要上传")]),_._v(" "),v("li",[_._v("权限控制（桶/对象）：可以扩展外链分享功能")]),_._v(" "),v("li",[_._v("多版本支持快照和闪回（flashback）")]),_._v(" "),v("li",[_._v("差分同步：同一个对象的多版本  能减少传输和存储量")]),_._v(" "),v("li",[_._v("纠删码（"),v("code",[_._v("EC")]),_._v("）或者重复数据删除（"),v("code",[_._v("CDC")]),_._v("/"),v("code",[_._v("FSP")]),_._v("）：节省归档类存储的占用空间")]),_._v(" "),v("li",[_._v("能够识别对象类型：支持自定义插件，做对应的操作")]),_._v(" "),v("li",[_._v("在线预览：图片、视频、Office文档、PDF、CAD文档等")]),_._v(" "),v("li",[_._v("能够通过自定义存储适配器，引用、适配其他存储的数据")]),_._v(" "),v("li",[_._v("...")])]),_._v(" "),v("h2",{attrs:{id:"现状"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#现状"}},[_._v("#")]),_._v(" 现状")]),_._v(" "),v("p",[_._v("近10多年来，开源基础设施大量涌现，动手实现一个简单的单机NAS越来越容易。比如："),v("code",[_._v("LevelDB")]),_._v("/"),v("code",[_._v("RocksDB")]),_._v("、"),v("code",[_._v("etcd")]),_._v("/"),v("code",[_._v("consul")]),_._v("、各种"),v("code",[_._v("Paxos")]),_._v("/"),v("code",[_._v("Raft")]),_._v("的实现。这里我们先从单机NAS开始说起，通过提供相同的适配器，让实现多节点多副本等组合方案变成简单的事情。通过系列文章，我希望能够手把手带你实现一个NAS，借鉴同类设计的好的经验，一起交付一个好(sì)东(bù)西(xiàng)，并且这应该是不限制语言的，文中使用Go语言作为示例。")]),_._v(" "),v("h3",{attrs:{id:"反思不好的设计"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#反思不好的设计"}},[_._v("#")]),_._v(" 反思不好的设计")]),_._v(" "),v("p",[_._v("这么多年收获了不少经验，也有过不少过度设计、走弯路的经历，总结发现基于当下的场景去设计和实现才更有意义。")]),_._v(" "),v("ul",[v("li",[_._v("比如断电一致性中关于保障数据完整的部分，以前的方案是实时刷盘，在部分场景下，可改进为几秒刷一次盘，产生偶发故障后，能识别出需要重传的对象即可。")]),_._v(" "),v("li",[_._v("比如因为数据依赖元数据而存在，导致写入流程复杂、步骤多、性能差：先要创建不完整对象，再写入数据，再设置属性为完整。")]),_._v(" "),v("li",[_._v("比如提前设计了一些未来可能用的功能，维护了很多年直到被删除都没有被实际需求化到。")]),_._v(" "),v("li",[_._v("比如所有操作都是单对象的，改为批量很复杂，"),v("code",[_._v("OrcaS")]),_._v("默认操作是批量的。")]),_._v(" "),v("li",[_._v("比如数据部分还保留了上下级关系，增加了很多额外的维护成本。")])]),_._v(" "),v("h2",{attrs:{id:"路线图"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#路线图"}},[_._v("#")]),_._v(" 路线图")]),_._v(" "),v("p",[_._v("☑️ "),v("a",{attrs:{href:"https://orcastor.github.io/doc/orcas/DESIGN.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("单机单副本"),v("OutboundLink")],1)]),_._v(" "),v("ul",[v("li",[_._v("支持上传下载的基础功能")]),_._v(" "),v("li",[_._v("以及额外的比如秒传、压缩、加密、打包等")])]),_._v(" "),v("p",[_._v("☑️ 支持网络协议")]),_._v(" "),v("ul",[v("li",[_._v("中间增加"),v("a",{attrs:{href:"https://github.com/orcastor/orcas/blob/master/rpc",target:"_blank",rel:"noopener noreferrer"}},[_._v("网络传输层"),v("OutboundLink")],1),_._v("，补充"),v("a",{attrs:{href:"https://github.com/orcastor/orcas/blob/master/core/auth.go",target:"_blank",rel:"noopener noreferrer"}},[_._v("鉴权逻辑"),v("OutboundLink")],1)]),_._v(" "),v("li",[_._v("支持多种常见网络协议")]),_._v(" "),v("li",[_._v("支持"),v("a",{attrs:{href:"https://github.com/orcastor/orcas/blob/master/sdk/sdk_test.go",target:"_blank",rel:"noopener noreferrer"}},[_._v("cli工具"),v("OutboundLink")],1),_._v("、"),v("a",{attrs:{href:"https://github.com/orcastor/admin",target:"_blank",rel:"noopener noreferrer"}},[_._v("前端管理页面"),v("OutboundLink")],1)]),_._v(" "),v("li",[_._v("支持"),v("a",{attrs:{href:"https://github.com/orcastor/webapp",target:"_blank",rel:"noopener noreferrer"}},[_._v("前端界面"),v("OutboundLink")],1)])]),_._v(" "),v("p",[_._v("⏳ 支持docker")]),_._v(" "),v("ul",[v("li",[_._v("支持开箱即用（借鉴"),v("code",[_._v("MinIO")]),_._v("）")])]),_._v(" "),v("p",[_._v("⏳ 支持虚拟盘")]),_._v(" "),v("ul",[v("li",[_._v("支持smb协议")]),_._v(" "),v("li",[_._v("支持FUSE，能挂载成虚拟磁盘")])]),_._v(" "),v("p",[_._v("⏳ 支持多副本、多节点、多集群")]),_._v(" "),v("ul",[v("li",[_._v("支持多节点分布式部署，默认3节点3副本配12块磁盘")]),_._v(" "),v("li",[_._v("支持负载均衡、高可用、故障切换方案")]),_._v(" "),v("li",[_._v("支持换盘、数据修复和迁移等")]),_._v(" "),v("li",[_._v("支持按集群扩容，规避集群内扩容的数据迁移问题")]),_._v(" "),v("li",[_._v("参考"),v("code",[_._v("Ceph")]),_._v("的PG，"),v("code",[_._v("TiKV")]),_._v("的PD等")])]),_._v(" "),v("p",[_._v("⏳ 支持S3兼容")]),_._v(" "),v("ul",[v("li",[_._v("提供"),v("code",[_._v("Amazon S3")]),_._v("、"),v("code",[_._v("Swift")]),_._v("兼容的RESTful API")])]),_._v(" "),v("p",[_._v("⏳ 支持纠删码")]),_._v(" "),v("ul",[v("li",[_._v("减少多副本的存储空间浪费")])]),_._v(" "),v("h2",{attrs:{id:"参考文档"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[_._v("#")]),_._v(" 参考文档")]),_._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://www.jb51.net/article/210814.htm",target:"_blank",rel:"noopener noreferrer"}},[_._v("OpenStack的Swift组件详解"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/531850954",target:"_blank",rel:"noopener noreferrer"}},[_._v("放弃FastDFS，拥抱MinIO的7大理由"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=e.exports}}]);